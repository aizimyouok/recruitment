<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>채용 현황 관리 시스템</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        .icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            vertical-align: middle;
        }
        /* 모달 트랜지션용 */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 200ms ease-out; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.95); transition: all 200ms ease-in; }

        /* 사이드바 트랜지션 */
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        /* 테이블 셀 줄바꿈 방지 */
        .table-cell-nowrap {
            white-space: nowrap;
        }
        /* 지원자 관리 필터 너비 */
        .filter-select {
            min-width: 120px;
        }
        /* 레이더 차트 컨테이너 */
        .radar-chart-container {
            position: relative;
            height: 400px; /* 필요에 따라 조절 */
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <!-- 
      컴포넌트 파일을 먼저 로드합니다.
    -->
    <script type="text/babel" src="components/Icon.js"></script>
    <script type="text/babel" src="components/ChartComponent.js"></script>
    <script type="text/babel" src="components/Login.js"></script>
    <script type="text/babel" src="components/KPICard.js"></script>
    <script type="text/babel" src="components/ConversionStep.js"></script>
    <script type="text/babel" src="components/UI.js"></script> 
    <script type="text/babel" src="components/Sidebar.js"></script>
    <script type="text/babel" src="components/DashboardSettingsModal.js"></script>
    <script type="text/babel" src="components/JobDetailModal.js"></script>
    <script type="text/babel" src="components/SiteSummary.js"></script>

    <!-- 
      페이지 컴포넌트를 로드합니다.
      (Dashboard는 SiteSummary에 의존하므로 그 뒤에 로드합니다.)
    -->
    <script type="text/babel" src="pages/Dashboard.js"></script>

    <!-- 
      메인 애플리케이션 스크립트.
    -->
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef, useCallback } = React;

        // Firebase 초기화
        let db = null;
        let auth = null;
        const initFirebase = (config) => {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(config);
                }
                db = firebase.firestore();
                auth = firebase.auth();
                return true;
            } catch (error) {
                console.error("Firebase 초기화 오류:", error);
                return false;
            }
        };

        // --- 메인 앱 ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);

            const [currentPage, setCurrentPage] = useState('dashboard');
            const [jobs, setJobs] = useState([]);
            const [dailyRecords, setDailyRecords] = useState([]);
            const [applicants, setApplicants] = useState([]);
            const [siteSettings, setSiteSettings] = useState([]);
            const [goals, setGoals] = useState([]);
            const [loading, setLoading] = useState(true);

            const [isSidebarOpen, setIsSidebarOpen] = useState(false);

            useEffect(() => {
                // --- Firebase 설정 직접 입력 ---
                const firebaseConfig = {
                  apiKey: "AIzaSyAObneOsBpf4up7PRQLx6KUM_ixvuZqcUQ",
                  authDomain: "recruitment-system-8f83c.firebaseapp.com",
                  projectId: "recruitment-system-8f83c",
                  storageBucket: "recruitment-system-8f83c.appspot.com",
                  messagingSenderId: "627405471475",
                  appId: "1:627405471475:web:8bbbf4d4b6302671190186"
                };

                const success = initFirebase(firebaseConfig);

                if (success) {
                    const unsubscribe = auth.onAuthStateChanged(firebaseUser => {
                        if (firebaseUser) {
                            setUser(firebaseUser);
                            loadData();
                        } else {
                            setUser(null);
                            setJobs([]); setDailyRecords([]); setApplicants([]);
                            setSiteSettings([]); setGoals([]);
                        }
                        setAuthLoading(false);
                    });
                    return () => unsubscribe();
                } else {
                    console.error("Firebase 초기화 실패!");
                    alert("Firebase 초기화에 실패했습니다. 코드를 확인해주세요.");
                    setAuthLoading(false);
                    setLoading(false);
                }
            }, []);

            const handleLogin = () => {
                 setAuthLoading(true);
            }

            // 데이터 로드 함수
            const loadData = useCallback(async () => {
                if (!auth.currentUser) return;
                 // setLoading(true); // 이미 로딩 중이면 다시 true로 설정하지 않음
                try {
                    const [jobsSnapshot, recordsSnapshot, applicantsSnapshot, settingsSnapshot, goalsSnapshot] = await Promise.all([
                        db.collection('jobs').get(),
                        db.collection('dailyRecords').get(),
                        db.collection('applicants').orderBy('appliedDate', 'desc').get(),
                        db.collection('siteSettings').get(),
                        db.collection('goals').get()
                    ]);

                    setJobs(jobsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    setDailyRecords(recordsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    setApplicants(applicantsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    setSiteSettings(settingsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    setGoals(goalsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })));

                } catch (error) {
                    console.error("데이터 로드 오류:", error);
                    setLoading(false); // 오류 발생 시 로딩 상태 해제
                } finally {
                     // 데이터 로드 완료 후 로딩 상태 해제 (중복 호출 방지)
                    if (loading) setLoading(false);
                }
            }, [loading]);


            if (authLoading) {
                 return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"></div>
                            <p className="text-gray-600">인증 확인 중...</p>
                        </div>
                    </div>
                 );
            }

            if (!user) {
                return <Login onLogin={handleLogin} />;
            }

            // 초기 로딩 시 또는 데이터가 없을 때 로딩 표시
            if (loading && !jobs.length && !applicants.length) {
                 return (
                     <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"></div>
                            <p className="text-gray-600">데이터를 불러오는 중...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col md:flex-row h-screen bg-gray-50 relative">
                    <Sidebar
                        currentPage={currentPage}
                        setCurrentPage={setCurrentPage}
                        user={user}
                        isSidebarOpen={isSidebarOpen}
                        setIsSidebarOpen={setIsSidebarOpen}
                    />
                    <div className="flex-1 overflow-auto">
                        <div className="sticky top-0 bg-white shadow-sm p-4 z-10 md:hidden flex justify-between items-center">
                            <h1 className="text-lg font-bold text-gray-800">
                                { currentPage === 'applicants' ? '지원자 관리' :
                                  currentPage === 'daily' ? '조회수 업데이트' :
                                  currentPage.charAt(0).toUpperCase() + currentPage.slice(1) }
                            </h1>
                            <button onClick={() => setIsSidebarOpen(true)} className="text-gray-600">
                                <Icon name="menu" size={28} />
                            </button>
                        </div>

                        {currentPage === 'dashboard' && <Dashboard jobs={jobs} dailyRecords={dailyRecords} applicants={applicants} siteSettings={siteSettings} goals={goals} />}
                        {currentPage === 'jobs' && <JobManagement jobs={jobs} applicants={applicants} loadData={loadData} />}
                        {currentPage === 'applicants' && <ApplicantManagement applicants={applicants} jobs={jobs} loadData={loadData} />}
                        {currentPage === 'daily' && <DailyUpdate jobs={jobs} dailyRecords={dailyRecords} loadData={loadData} />}
                        {currentPage === 'compare' && <SiteComparison jobs={jobs} applicants={applicants} dailyRecords={dailyRecords} />}
                        {currentPage === 'efficiency' && <EfficiencyAnalysis jobs={jobs} applicants={applicants} siteSettings={siteSettings} />}
                        {currentPage === 'trends' && <TrendAnalysis jobs={jobs} dailyRecords={dailyRecords} applicants={applicants} />}
                        {currentPage === 'settings' && <Settings siteSettings={siteSettings} goals={goals} loadData={loadData} />}
                    </div>
                </div>
            );
        };

        // --- 사이드바 ---
        // components/Sidebar.js로 이동했습니다.

        // --- 대시보드 위젯 설정 모달 ---
        // components/DashboardSettingsModal.js로 이동했습니다.

        // --- 대시보드 ---
        // pages/Dashboard.js로 이동했습니다.

        // --- 사이트별 현황 ---
        // components/SiteSummary.js로 이동했습니다.

        // --- 공고별 상세 분석 모달 ---
        // components/JobDetailModal.js로 이동했습니다.

        // 공고 관리
        const JobManagement = ({ jobs, applicants, loadData }) => {
            const [showForm, setShowForm] = useState(false);
            const [editingJob, setEditingJob] = useState(null);
            const [selectedJob, setSelectedJob] = useState(null);
            const [formData, setFormData] = useState({ site: '사람인', title: '', position: '', company: '', startDate: '', endDate: '', status: '진행중', memo: '' });

            const handleSubmit = async (e) => {
                e.preventDefault();
                try {
                    const data = { ...formData, updatedAt: new Date().toISOString() };
                    if (editingJob) await db.collection('jobs').doc(editingJob.id).update(data);
                    else await db.collection('jobs').add({ ...data, createdAt: new Date().toISOString() });
                    resetForm(); loadData(); alert('저장되었습니다!');
                } catch (error) { alert('저장 실패: ' + error.message); }
            };
            const handleEdit = (e, job) => { e.stopPropagation(); setEditingJob(job); setFormData(job); setShowForm(true); };
            const handleDelete = async (e, id) => {
                e.stopPropagation();
                if (confirm('정말 삭제하시겠습니까?')) {
                    try { await db.collection('jobs').doc(id).delete(); loadData(); alert('삭제되었습니다!'); }
                    catch (error) { alert('삭제 실패: ' + error.message); }
                }
            };
            const resetForm = () => { setShowForm(false); setEditingJob(null); setFormData({ site: '사람인', title: '', position: '', company: '', startDate: '', endDate: '', status: '진행중', memo: '' }); };

            return (
                <div className="p-4 md:p-8">
                    <div className="flex justify-between items-center mb-8">
                        <h2 className="text-2xl md:text-3xl font-bold text-gray-800">공고 관리</h2>
                        <button onClick={() => setShowForm(true)} className="btn-primary px-4 py-2 md:px-6 md:py-3 flex items-center space-x-2">
                            <Icon name="plus" size={20} /> <span className="hidden md:inline">공고 추가</span>
                        </button>
                    </div>
                    {showForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl shadow-2xl p-6 md:p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6">{editingJob ? '공고 수정' : '공고 추가'}</h3>
                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <div><label className="label-style">채용 사이트</label><Select name="site" value={formData.site} onChange={e => setFormData({...formData, site: e.target.value})} required><option>사람인</option><option>잡코리아</option><option>인크루트</option></Select></div>
                                    <div><label className="label-style">공고 제목</label><Input type="text" name="title" value={formData.title} onChange={e => setFormData({...formData, title: e.target.value})} required /></div>
                                    <div><label className="label-style">직무/포지션</label><Input type="text" name="position" value={formData.position} onChange={e => setFormData({...formData, position: e.target.value})} required /></div>
                                    <div><label className="label-style">게시 업체명</label><Input type="text" name="company" value={formData.company} onChange={e => setFormData({...formData, company: e.target.value})} required /></div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="label-style">게시 시작일</label><Input type="date" name="startDate" value={formData.startDate} onChange={e => setFormData({...formData, startDate: e.target.value})} required /></div>
                                        <div><label className="label-style">게시 종료일</label><Input type="date" name="endDate" value={formData.endDate} onChange={e => setFormData({...formData, endDate: e.target.value})} required /></div>
                                    </div>
                                    <div><label className="label-style">공고 상태</label><Select name="status" value={formData.status} onChange={e => setFormData({...formData, status: e.target.value})}><option>진행중</option><option>마감</option></Select></div>
                                    <div><label className="label-style">메모</label><Textarea name="memo" value={formData.memo} onChange={e => setFormData({...formData, memo: e.target.value})} rows="3" /></div>
                                    <div className="flex space-x-4"><Button type="submit" variant="primary" className="flex-1">{editingJob ? '수정' : '추가'}</Button><Button type="button" variant="secondary" className="flex-1" onClick={resetForm}>취소</Button></div>
                                </form>
                            </div>
                        </div>
                    )}
                    {selectedJob && <JobDetailModal job={selectedJob} applicants={applicants} onClose={() => setSelectedJob(null)} />}
                    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-50"><tr><th className="th-style">사이트</th><th className="th-style">공고 제목</th><th className="th-style">직무</th><th className="th-style">업체명</th><th className="th-style">기간</th><th className="th-style">상태</th><th className="th-style">작업</th></tr></thead>
                                <tbody className="divide-y divide-gray-200">
                                    {jobs.map(job => (
                                        <tr key={job.id} className="hover:bg-gray-100 cursor-pointer" onClick={() => setSelectedJob(job)}>
                                            <td className="td-style table-cell-nowrap"><span className="badge-blue">{job.site}</span></td><td className="td-style table-cell-nowrap">{job.title}</td><td className="td-style table-cell-nowrap">{job.position}</td>
                                            <td className="td-style table-cell-nowrap">{job.company}</td><td className="td-style table-cell-nowrap text-sm text-gray-600">{job.startDate} ~ {job.endDate}</td>
                                            <td className="td-style table-cell-nowrap"><span className={job.status === '진행중' ? 'badge-green' : 'badge-gray'}>{job.status}</span></td>
                                            <td className="td-style table-cell-nowrap"><div className="flex space-x-2"><button onClick={(e) => handleEdit(e, job)} className="text-blue-600 hover:text-blue-800"><Icon name="edit" size={18} /></button><button onClick={(e) => handleDelete(e, job.id)} className="text-red-600 hover:text-red-800"><Icon name="trash-2" size={18} /></button></div></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        {jobs.length === 0 && <div className="text-center py-12 text-gray-500">등록된 공고가 없습니다.</div>}
                    </div>
                </div>
            );
        };

        // --- 지원자 관리 ---
        const ApplicantManagement = ({ applicants, jobs, loadData }) => {
            const [showForm, setShowForm] = useState(false);
            const [editingApplicant, setEditingApplicant] = useState(null);
            const [formData, setFormData] = useState({ name: '', gender: '남', age: '', contactInfo: '', appliedJobId: '', appliedDate: new Date().toISOString().split('T')[0], status: '지원', memo: '' });
            const [filters, setFilters] = useState({ jobId: 'all', status: 'all' });
            const [searchTerm, setSearchTerm] = useState('');

            const activeJobs = useMemo(() => jobs.filter(j => j.status === '진행중'), [jobs]);
            const applicantStatuses = ['지원', '서류검토', '면접', '합격', '입사', '불합격'];

            useEffect(() => {
                if (!editingApplicant && activeJobs.length > 0 && !formData.appliedJobId) {
                    setFormData(prev => ({ ...prev, appliedJobId: activeJobs[0].id }));
                }
            }, [activeJobs, editingApplicant, formData.appliedJobId]);

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!formData.appliedJobId) { alert('지원 공고를 선택해주세요.'); return; }
                try {
                    const data = { ...formData, age: Number(formData.age) || null, updatedAt: new Date().toISOString() };
                    if (editingApplicant) await db.collection('applicants').doc(editingApplicant.id).update(data);
                    else await db.collection('applicants').add({ ...data, createdAt: new Date().toISOString() });
                    resetForm(); loadData(); alert('저장되었습니다!');
                } catch (error) { alert('저장 실패: ' + error.message); }
            };

            const handleEdit = (applicant) => {
                setEditingApplicant(applicant);
                setFormData({ name: applicant.name || '', gender: applicant.gender || '남', age: applicant.age || '', contactInfo: applicant.contactInfo || '', appliedJobId: applicant.appliedJobId || '', appliedDate: applicant.appliedDate || new Date().toISOString().split('T')[0], status: applicant.status || '지원', memo: applicant.memo || '' });
                setShowForm(true);
            };

            const handleDelete = async (id) => {
                if (confirm('정말 삭제하시겠습니까? 지원자 정보가 영구적으로 삭제됩니다.')) {
                    try { await db.collection('applicants').doc(id).delete(); loadData(); alert('삭제되었습니다!'); }
                    catch (error) { alert('삭제 실패: ' + error.message); }
                }
            };

            const resetForm = () => {
                setShowForm(false); setEditingApplicant(null);
                setFormData({ name: '', gender: '남', age: '', contactInfo: '', appliedJobId: activeJobs.length > 0 ? activeJobs[0].id : '', appliedDate: new Date().toISOString().split('T')[0], status: '지원', memo: '' });
            };

            const handleStatusChange = async (applicantId, newStatus) => {
                try { await db.collection('applicants').doc(applicantId).update({ status: newStatus, updatedAt: new Date().toISOString() }); loadData(); }
                catch (error) { alert('상태 변경 실패: ' + error.message); }
            };

            const filteredApplicants = useMemo(() => {
                return applicants.filter(a => {
                    const jobMatch = filters.jobId === 'all' || a.appliedJobId === filters.jobId;
                    const statusMatch = filters.status === 'all' || a.status === filters.status;
                    const nameMatch = searchTerm === '' || (a.name && a.name.toLowerCase().includes(searchTerm.toLowerCase()));
                    return jobMatch && statusMatch && nameMatch;
                });
            }, [applicants, filters, searchTerm]);

            const getJobTitle = useCallback((jobId) => jobs.find(j => j.id === jobId)?.title || 'N/A', [jobs]);

            return (
                <div className="p-4 md:p-8">
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                        <h2 className="text-2xl md:text-3xl font-bold text-gray-800">지원자 관리</h2>
                        <button onClick={() => setShowForm(true)} className="btn-primary px-4 py-2 md:px-6 md:py-3 flex items-center space-x-2 mt-4 md:mt-0">
                            <Icon name="user-plus" size={20} /> <span>지원자 추가</span>
                        </button>
                    </div>

                    {showForm && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl shadow-2xl p-6 md:p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                <h3 className="text-2xl font-bold mb-6">{editingApplicant ? '지원자 수정' : '지원자 추가'}</h3>
                                <form onSubmit={handleSubmit} className="space-y-4">
                                     <div><label className="label-style">이름</label><Input type="text" name="name" value={formData.name} onChange={handleInputChange} required /></div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="label-style">성별</label><Select name="gender" value={formData.gender} onChange={handleInputChange}><option>남</option><option>여</option></Select></div>
                                        <div><label className="label-style">나이</label><Input type="number" name="age" value={formData.age} onChange={handleInputChange} placeholder="숫자만 입력" /></div>
                                    </div>
                                    <div><label className="label-style">연락처</label><Input type="text" name="contactInfo" value={formData.contactInfo} onChange={handleInputChange} /></div>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="label-style">지원 공고</label><Select name="appliedJobId" value={formData.appliedJobId} onChange={handleInputChange} required><option value="">-- 공고 선택 --</option>{activeJobs.map(job => <option key={job.id} value={job.id}>{job.title} ({job.site})</option>)}</Select></div>
                                        <div><label className="label-style">지원 날짜</label><Input type="date" name="appliedDate" value={formData.appliedDate} onChange={handleInputChange} required /></div>
                                    </div>
                                     <div><label className="label-style">현재 상태</label><Select name="status" value={formData.status} onChange={handleInputChange}>{applicantStatuses.map(status => <option key={status} value={status}>{status}</option>)}</Select></div>
                                    <div><label className="label-style">메모</label><Textarea name="memo" value={formData.memo} onChange={handleInputChange} rows="3" /></div>
                                    <div className="flex space-x-4"><Button type="submit" variant="primary" className="flex-1">{editingApplicant ? '수정' : '추가'}</Button><Button type="button" variant="secondary" className="flex-1" onClick={resetForm}>취소</Button></div>
                                </form>
                            </div>
                        </div>
                    )}

                    <div className="bg-white rounded-xl shadow-lg p-4 mb-6">
                        <div className="flex flex-col md:flex-row md:items-center gap-4">
                            <div className="min-w-0 md:w-64">
                                <Input type="text" placeholder="이름 검색..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                            </div>
                            <div className="flex space-x-2 w-full md:w-auto md:ml-auto">
                                <Select value={filters.jobId} onChange={(e) => setFilters(prev => ({ ...prev, jobId: e.target.value }))} className="filter-select flex-1 md:flex-none"><option value="all">모든 공고</option>{activeJobs.map(job => <option key={job.id} value={job.id}>{job.title}</option>)}</Select>
                                <Select value={filters.status} onChange={(e) => setFilters(prev => ({ ...prev, status: e.target.value }))} className="filter-select flex-1 md:flex-none"><option value="all">모든 상태</option>{applicantStatuses.map(status => <option key={status} value={status}>{status}</option>)}</Select>
                            </div>
                        </div>
                    </div>

                    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="w-full text-sm">
                                <thead className="bg-gray-50"><tr><th className="th-style">이름</th><th className="th-style">성별</th><th className="th-style">나이</th><th className="th-style">연락처</th><th className="th-style">지원 공고</th><th className="th-style">지원일</th><th className="th-style">상태</th><th className="th-style">작업</th></tr></thead>
                                <tbody className="divide-y divide-gray-200">
                                    {filteredApplicants.map(applicant => (
                                        <tr key={applicant.id} className="hover:bg-gray-50">
                                            <td className="td-style table-cell-nowrap">{applicant.name}</td><td className="td-style table-cell-nowrap">{applicant.gender}</td><td className="td-style table-cell-nowrap">{applicant.age}</td>
                                            <td className="td-style table-cell-nowrap">{applicant.contactInfo}</td><td className="td-style table-cell-nowrap">{getJobTitle(applicant.appliedJobId)}</td>
                                            <td className="td-style table-cell-nowrap">{applicant.appliedDate}</td>
                                            <td className="td-style table-cell-nowrap"><Select value={applicant.status} onChange={(e) => handleStatusChange(applicant.id, e.target.value)} className="p-1 text-xs w-24">{applicantStatuses.map(s => <option key={s} value={s}>{s}</option>)}</Select></td>
                                            <td className="td-style table-cell-nowrap"><div className="flex space-x-2"><button onClick={() => handleEdit(applicant)} className="text-blue-600 hover:text-blue-800"><Icon name="edit" size={16} /></button><button onClick={() => handleDelete(applicant.id)} className="text-red-600 hover:text-red-800"><Icon name="trash-2" size={16} /></button></div></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                        {applicants.length === 0 && <div className="text-center py-12 text-gray-500">등록된 지원자가 없습니다.</div>}
                        {applicants.length > 0 && filteredApplicants.length === 0 && <div className="text-center py-12 text-gray-500">필터 결과와 일치하는 지원자가 없습니다.</div>}
                    </div>
                </div>
            );
        };

        // --- 조회수 업데이트 ---
        const DailyUpdate = ({ jobs, dailyRecords, loadData }) => {
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [viewInputs, setViewInputs] = useState({});
            const [previousViews, setPreviousViews] = useState({});
            const [recordsForDate, setRecordsForDate] = useState({});
            const [isSaving, setIsSaving] = useState(false);

            const activeJobs = useMemo(() => jobs.filter(j => j.status === '진행중'), [jobs]);

            useEffect(() => {
                const recordsBefore = dailyRecords.filter(r => r.date < selectedDate);
                const recordsOn = dailyRecords.filter(r => r.date === selectedDate);
                const newPrevViews = {}, newCurrentViews = {}, newRecordsForDate = {};
                for (const job of activeJobs) {
                    const jobRecordsBefore = recordsBefore.filter(r => r.jobId === job.id);
                    const jobRecordsOn = recordsOn.filter(r => r.jobId === job.id);
                    const prevTotalViews = jobRecordsBefore.reduce((sum, r) => sum + (r.viewsIncrease || 0), 0);
                    const increaseOnDate = jobRecordsOn.reduce((sum, r) => sum + (r.viewsIncrease || 0), 0);
                    newPrevViews[job.id] = prevTotalViews;
                    newCurrentViews[job.id] = prevTotalViews + increaseOnDate;
                    newRecordsForDate[job.id] = jobRecordsOn.map(r => r.id);
                }
                setPreviousViews(newPrevViews); setViewInputs(newCurrentViews); setRecordsForDate(newRecordsForDate);
            }, [selectedDate, dailyRecords, activeJobs]);

            const handleChange = (jobId, value) => { setViewInputs(prev => ({ ...prev, [jobId]: value === '' ? '' : (parseInt(value) || 0) })); };
            const handleSubmit = async () => {
                setIsSaving(true);
                try {
                    const batch = db.batch();
                    for (const [jobId, currentViewInput] of Object.entries(viewInputs)) {
                        const recordsToDelete = recordsForDate[jobId] || [];
                        recordsToDelete.forEach(docId => batch.delete(db.collection('dailyRecords').doc(docId)));
                        const prevTotal = previousViews[jobId] || 0;
                        const currentTotal = currentViewInput || 0;
                        const increase = currentTotal - prevTotal;
                        if (increase !== 0) {
                            const docRef = db.collection('dailyRecords').doc();
                            batch.set(docRef, { jobId, date: selectedDate, viewsIncrease: increase, createdAt: new Date().toISOString() });
                        }
                    }
                    await batch.commit(); alert('조회수가 저장되었습니다!'); loadData();
                } catch (error) { alert('저장 실패: ' + error.message); }
                finally { setIsSaving(false); }
            };

            return (
                <div className="p-4 md:p-8">
                    <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                        <div>
                            <h2 className="text-2xl md:text-3xl font-bold text-gray-800 mb-4">조회수 업데이트</h2>
                            <div className="flex items-center space-x-4"><label className="font-medium text-gray-700">날짜:</label><Input type="date" value={selectedDate} onChange={(e) => setSelectedDate(e.target.value)} /></div>
                        </div>
                        {activeJobs.length > 0 && <Button onClick={handleSubmit} disabled={isSaving} variant="primary" className="mt-4 md:mt-0 w-full md:w-auto">{isSaving ? '저장 중...' : '조회수 저장'}</Button>}
                    </div>
                    <div className="space-y-4 mb-8">
                        {activeJobs.map(job => (
                            <div key={job.id} className="bg-white rounded-xl shadow-lg p-6">
                                <div className="mb-4"><h3 className="text-lg font-semibold text-gray-800">{job.title}</h3><p className="text-sm text-gray-600">{job.site} | {job.position}</p></div>
                                <div><label className="label-style mb-1">조회수 (누적)</label><Input type="number" min="0" value={viewInputs[job.id] ?? ''} onChange={(e) => handleChange(job.id, e.target.value)} className="w-full md:w-1/2 lg:w-1/3" placeholder="0" /><p className="text-xs text-gray-500 mt-1">(어제까지 누적: {previousViews[job.id] || 0})</p></div>
                            </div>
                        ))}
                    </div>
                    {activeJobs.length === 0 && <div className="text-center py-12 text-gray-500">진행중인 공고가 없습니다.</div>}
                </div>
            );
        };

        // --- 사이트 비교 ---
        const SiteComparison = ({ jobs, applicants, dailyRecords }) => {
            const sites = ['사람인', '잡코리아', '인크루트'];
            const siteData = useMemo(() => {
                return sites.map(site => {
                    const siteJobs = jobs.filter(j => j.site === site); const jobIds = siteJobs.map(j => j.id);
                    const siteRecords = dailyRecords.filter(r => jobIds.includes(r.jobId)); const totalViews = siteRecords.reduce((sum, r) => sum + (r.viewsIncrease || 0), 0);
                    const siteApplicants = applicants.filter(a => jobIds.includes(a.appliedJobId));
                    const totals = { site, jobs: siteJobs.length, views: totalViews, applications: 0, contacts: 0, interviews: 0, offers: 0, hires: 0 };
                    siteApplicants.forEach(a => { totals.applications++; if (['면접', '합격', '입사'].includes(a.status)) totals.interviews++; if (['합격', '입사'].includes(a.status)) totals.offers++; if (a.status === '입사') totals.hires++; });
                    totals.conversionRate = totals.applications > 0 ? ((totals.hires / totals.applications) * 100).toFixed(1) : 0;
                    return totals;
                });
            }, [jobs, applicants, dailyRecords]);
            const chartData = {
                labels: siteData.map(d => d.site),
                datasets: [ { label: '지원자', data: siteData.map(d => d.applications), backgroundColor: 'rgba(59, 130, 246, 0.8)' }, { label: '면접', data: siteData.map(d => d.interviews), backgroundColor: 'rgba(139, 92, 246, 0.8)' }, { label: '입사자', data: siteData.map(d => d.hires), backgroundColor: 'rgba(16, 185, 129, 0.8)' } ]
            };
            return (
                <div className="p-4 md:p-8">
                    <h2 className="text-2xl md:text-3xl font-bold text-gray-800 mb-8">사이트 비교</h2>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        {siteData.map(data => (
                            <div key={data.site} className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="text-xl font-bold text-center mb-6 text-blue-600">{data.site}</h3>
                                <div className="space-y-3">
                                    <div className="stat-item"><span className="stat-label">공고 수</span><span className="stat-value">{data.jobs}</span></div><div className="stat-item"><span className="stat-label">조회수</span><span className="stat-value">{data.views}</span></div>
                                    <div className="stat-item"><span className="stat-label">지원자</span><span className="stat-value">{data.applications}</span></div><div className="stat-item"><span className="stat-label">면접</span><span className="stat-value">{data.interviews}</span></div>
                                    <div className="stat-item"><span className="stat-label">합격자</span><span className="stat-value">{data.offers}</span></div><div className="stat-item"><span className="stat-label">입사자</span><span className="stat-value text-green-600">{data.hires}</span></div>
                                    <div className="flex justify-between items-center pt-2"><span className="text-gray-600 font-semibold">전환율</span><span className="text-2xl font-bold text-blue-600">{data.conversionRate}%</span></div>
                                </div>
                            </div>
                        ))}
                    </div>
                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <h3 className="text-xl font-semibold mb-4">사이트별 비교 차트</h3><div style={{ height: '350px' }}><ChartComponent type="bar" data={chartData} options={{ scales: { y: { beginAtZero: true } } }} /></div>
                    </div>
                </div>
            );
        };

        // --- 효율성 분석 ---
        const EfficiencyAnalysis = ({ jobs, applicants, siteSettings }) => {
            const analysisData = useMemo(() => {
                const sites = ['사람인', '잡코리아', '인크루트'];
                return sites.map(site => {
                    const siteJobs = jobs.filter(j => j.site === site); const jobIds = siteJobs.map(j => j.id); const settings = siteSettings.find(s => s.site === site);
                    const siteApplicants = applicants.filter(a => jobIds.includes(a.appliedJobId));
                    const totals = { applications: 0, contacts: 0, interviews: 0, offers: 0, hires: 0 };
                    siteApplicants.forEach(a => { totals.applications++; if (['면접', '합격', '입사'].includes(a.status)) totals.interviews++; if (['합격', '입사'].includes(a.status)) totals.offers++; if (a.status === '입사') totals.hires++; });
                    const cost = settings?.monthlyCost || 0; const costPerHire = totals.hires > 0 ? (cost / totals.hires).toFixed(0) : 0;
                    const rates = {
                        interviewFromAppRate: totals.applications > 0 ? ((totals.interviews / totals.applications) * 100).toFixed(1) : 0, offerFromInterviewRate: totals.interviews > 0 ? ((totals.offers / totals.interviews) * 100).toFixed(1) : 0,
                        hireFromOfferRate: totals.offers > 0 ? ((totals.hires / totals.offers) * 100).toFixed(1) : 0, overallRate: totals.applications > 0 ? ((totals.hires / totals.applications) * 100).toFixed(1) : 0
                    };
                    return { site, ...totals, ...rates, cost, costPerHire, efficiency: parseFloat(rates.overallRate) - (cost / 100000) };
                });
            }, [jobs, applicants, siteSettings]);
            const sortedBySite = [...analysisData].sort((a, b) => b.overallRate - a.overallRate);
            return (
                <div className="p-4 md:p-8">
                    <h2 className="text-2xl md:text-3xl font-bold text-gray-800 mb-8">효율성 분석</h2>
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-8">
                        <h3 className="text-xl font-semibold mb-6">단계별 전환율</h3>
                        <div className="space-y-6">
                            {analysisData.map(data => (
                                <div key={data.site} className="border-b pb-4 last:border-b-0">
                                    <h4 className="font-semibold text-lg mb-3">{data.site}</h4>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                                        <div><span className="text-gray-600">지원 → 면접</span><p className="rate-value text-blue-600">{data.interviewFromAppRate}%</p></div>
                                        <div><span className="text-gray-600">면접 → 합격</span><p className="rate-value text-purple-600">{data.offerFromInterviewRate}%</p></div>
                                        <div><span className="text-gray-600">합격 → 입사</span><p className="rate-value text-green-600">{data.hireFromOfferRate}%</p></div>
                                    </div>
                                    <div className="mt-3 pt-3 border-t"><span className="text-gray-600">총 전환율 (지원 → 입사)</span><p className="text-2xl font-bold text-blue-600">{data.overallRate}%</p></div>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-8">
                        <h3 className="text-xl font-semibold mb-6">비용 대비 효과 (ROI)</h3>
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-50"><tr><th className="th-style">사이트</th><th className="th-style">월 이용료</th><th className="th-style">입사자</th><th className="th-style">1인당 비용</th><th className="th-style">효율성 점수</th></tr></thead>
                                <tbody className="divide-y divide-gray-200">
                                    {analysisData.map(data => (
                                        <tr key={data.site} className="hover:bg-gray-50">
                                            <td className="td-style table-cell-nowrap">{data.site}</td><td className="td-style table-cell-nowrap">{data.cost.toLocaleString()}원</td><td className="td-style table-cell-nowrap">{data.hires}명</td>
                                            <td className="td-style table-cell-nowrap font-semibold text-blue-600">{data.costPerHire > 0 ? `${parseInt(data.costPerHire).toLocaleString()}원` : '-'}</td>
                                            <td className="td-style table-cell-nowrap"><span className={`badge-sm ${data.efficiency > 5 ? 'badge-green' : data.efficiency > 0 ? 'badge-yellow' : 'badge-red'}`}>{data.efficiency > 0 ? '높음' : data.efficiency > -5 ? '보통' : '낮음'}</span></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <h3 className="text-xl font-semibold mb-6">사이트별 종합 순위</h3>
                        <div className="space-y-4">
                            {sortedBySite.map((data, index) => (
                                <div key={data.site} className="flex flex-col md:flex-row items-start md:items-center space-y-2 md:space-y-0 md:space-x-4 p-4 bg-gray-50 rounded-lg">
                                    <div className={`text-3xl font-bold ${index === 0 ? 'text-yellow-500' : index === 1 ? 'text-gray-400' : 'text-orange-600'}`}>{index + 1}</div>
                                    <div className="flex-1"><h4 className="font-semibold text-lg">{data.site}</h4><p className="text-sm text-gray-600">전환율 {data.overallRate}% | 입사자 {data.hires}명</p></div>
                                    <div className="text-left md:text-right w-full md:w-auto"><p className="text-sm text-gray-600">1인당 비용</p><p className="text-lg font-bold text-blue-600">{data.costPerHire > 0 ? `${parseInt(data.costPerHire).toLocaleString()}원` : '-'}</p></div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // --- 트렌드 분석 ---
        const TrendAnalysis = ({ jobs, dailyRecords, applicants }) => {
            const [period, setPeriod] = useState('week');
            const [startDate, setStartDate] = useState('');
            const [endDate, setEndDate] = useState('');

            const trendData = useMemo(() => {
                let filteredRecords = [...dailyRecords]; let filteredApplicants = [...applicants];
                if (period !== 'all') {
                    let startDt, endDt = new Date();
                    if (period === 'custom' && startDate && endDate) { startDt = new Date(startDate); endDt = new Date(endDate); }
                    else { startDt = new Date(); let daysBack = 7; if (period === 'month') daysBack = 30; if (period === 'quarter') daysBack = 90; startDt.setDate(endDt.getDate() - daysBack); }
                    const startStr = startDt.toISOString().split('T')[0]; const endStr = endDt.toISOString().split('T')[0];
                    filteredRecords = filteredRecords.filter(r => r.date >= startStr && r.date <= endStr);
                    filteredApplicants = filteredApplicants.filter(a => a.appliedDate >= startStr && a.appliedDate <= endStr);
                }
                const dateMap = {};
                filteredRecords.forEach(record => { if (!dateMap[record.date]) dateMap[record.date] = { date: record.date, views: 0, applications: 0, interviews: 0, offers: 0, hires: 0 }; dateMap[record.date].views += record.viewsIncrease || 0; });
                filteredApplicants.forEach(applicant => { const date = applicant.appliedDate; if (!dateMap[date]) dateMap[date] = { date: date, views: 0, applications: 0, interviews: 0, offers: 0, hires: 0 }; dateMap[date].applications++; if (['면접', '합격', '입사'].includes(applicant.status)) dateMap[date].interviews++; if (['합격', '입사'].includes(applicant.status)) dateMap[date].offers++; if (applicant.status === '입사') dateMap[date].hires++; });
                return Object.values(dateMap).sort((a, b) => a.date.localeCompare(b.date));
            }, [dailyRecords, applicants, period, startDate, endDate]);

            const siteTrendData = useMemo(() => {
                const sites = ['사람인', '잡코리아', '인크루트'];
                return sites.map(site => { const siteJobs = jobs.filter(j => j.site === site); const jobIds = siteJobs.map(j => j.id); const siteApplicants = applicants.filter(a => jobIds.includes(a.appliedJobId)); return { site, applications: siteApplicants.length }; });
            }, [jobs, applicants]);

            const lineChartData = {
                labels: trendData.map(d => d.date),
                datasets: [ { label: '조회수', data: trendData.map(d => d.views), borderColor: 'rgb(59, 130, 246)', backgroundColor: 'rgba(59, 130, 246, 0.1)', tension: 0.4 }, { label: '지원자', data: trendData.map(d => d.applications), borderColor: 'rgb(16, 185, 129)', backgroundColor: 'rgba(16, 185, 129, 0.1)', tension: 0.4 }, { label: '면접', data: trendData.map(d => d.interviews), borderColor: 'rgb(139, 92, 246)', backgroundColor: 'rgba(139, 92, 246, 0.1)', tension: 0.4 }, { label: '입사자', data: trendData.map(d => d.hires), borderColor: 'rgb(245, 158, 11)', backgroundColor: 'rgba(245, 158, 11, 0.1)', tension: 0.4 } ]
            };
            const pieChartData = { labels: siteTrendData.map(d => d.site), datasets: [{ data: siteTrendData.map(d => d.applications), backgroundColor: ['rgba(59, 130, 246, 0.8)', 'rgba(16, 185, 129, 0.8)', 'rgba(245, 158, 11, 0.8)'] }] };

            return (
                <div className="p-4 md:p-8">
                    <h2 className="text-2xl md:text-3xl font-bold text-gray-800 mb-8">트렌드 분석</h2>
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-8">
                        <div className="flex flex-wrap items-center gap-4">
                            <div className="flex flex-wrap gap-2">
                                <button onClick={() => setPeriod('week')} className={`btn-period ${period === 'week' ? 'btn-period-active' : ''}`}>최근 1주일</button><button onClick={() => setPeriod('month')} className={`btn-period ${period === 'month' ? 'btn-period-active' : ''}`}>최근 1개월</button>
                                <button onClick={() => setPeriod('quarter')} className={`btn-period ${period === 'quarter' ? 'btn-period-active' : ''}`}>최근 3개월</button><button onClick={() => setPeriod('custom')} className={`btn-period ${period === 'custom' ? 'btn-period-active' : ''}`}>기간 선택</button>
                            </div>
                            {period === 'custom' && (<div className="flex items-center space-x-2"><Input type="date" value={startDate} onChange={(e) => setStartDate(e.target.value)} className="py-2" /><span>~</span><Input type="date" value={endDate} onChange={(e) => setEndDate(e.target.value)} className="py-2" /></div>)}
                        </div>
                    </div>
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-8"><h3 className="text-xl font-semibold mb-4">일별 채용 단계 추이</h3><div style={{ height: '350px' }}><ChartComponent type="line" data={lineChartData} options={{ scales: { y: { beginAtZero: true } } }} /></div></div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="bg-white rounded-xl shadow-lg p-6"><h3 className="text-xl font-semibold mb-4">사이트별 지원자 비율</h3><div style={{ height: '280px' }}><ChartComponent type="pie" data={pieChartData} /></div></div>
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-xl font-semibold mb-4">누적 데이터 (총 지원자)</h3>
                            <div className="space-y-4">
                                {siteTrendData.map((data, index) => (<div key={data.site} className="flex items-center justify-between"><div className="flex items-center space-x-3"><div className="w-4 h-4 rounded-full" style={{ backgroundColor: pieChartData.datasets[0].backgroundColor[index] }} /><span className="font-medium">{data.site}</span></div><span className="text-xl font-bold">{data.applications}명</span></div>))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 설정 ---
        const Settings = ({ siteSettings, goals, loadData }) => {
            const [activeTab, setActiveTab] = useState('sites');
            const [siteForm, setSiteForm] = useState({ site: '사람인', monthlyCost: 0, quarterlyCost: 0, startDate: '' });
            const [goalForm, setGoalForm] = useState({ yearMonth: '', targetHires: 0, targetSaramin: 0, targetJobkorea: 0, targetIncruit: 0 });

            useEffect(() => {
                if (activeTab === 'sites') { const existing = siteSettings.find(s => s.site === '사람인'); setSiteForm(existing || { site: '사람인', monthlyCost: 0, quarterlyCost: 0, startDate: '' }); }
                else if (activeTab === 'goals') { const today = new Date().toISOString().substring(0, 7); const existing = goals.find(g => g.yearMonth === today); setGoalForm(existing || { yearMonth: today, targetHires: 0, targetSaramin: 0, targetJobkorea: 0, targetIncruit: 0 }); }
            }, [activeTab, siteSettings, goals]);

            const handleSiteSubmit = async (e) => {
                e.preventDefault(); try { const existing = siteSettings.find(s => s.site === siteForm.site); const data = { ...siteForm, monthlyCost: Number(siteForm.monthlyCost), quarterlyCost: Number(siteForm.quarterlyCost) }; if (existing) await db.collection('siteSettings').doc(existing.id).update(data); else await db.collection('siteSettings').add(data); alert('저장되었습니다!'); loadData(); } catch (error) { alert('저장 실패: ' + error.message); }
            };
            const handleGoalSubmit = async (e) => {
                e.preventDefault(); try { const existing = goals.find(g => g.yearMonth === goalForm.yearMonth); const data = { ...goalForm, targetHires: Number(goalForm.targetHires), targetSaramin: Number(goalForm.targetSaramin), targetJobkorea: Number(goalForm.targetJobkorea), targetIncruit: Number(goalForm.targetIncruit) }; if (existing) await db.collection('goals').doc(existing.id).update(data); else await db.collection('goals').add(data); alert('저장되었습니다!'); loadData(); } catch (error) { alert('저장 실패: ' + error.message); }
            };

            return (
                <div className="p-4 md:p-8">
                    <h2 className="text-2xl md:text-3xl font-bold text-gray-800 mb-8">설정</h2>
                    <div className="flex space-x-2 mb-6">
                        <button onClick={() => setActiveTab('sites')} className={`btn-tab ${activeTab === 'sites' ? 'btn-tab-active' : ''}`}>사이트 이용료</button>
                        <button onClick={() => setActiveTab('goals')} className={`btn-tab ${activeTab === 'goals' ? 'btn-tab-active' : ''}`}>목표 설정</button>
                    </div>
                    {activeTab === 'sites' && (
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-xl font-semibold mb-6">사이트 이용료 설정</h3>
                            <form onSubmit={handleSiteSubmit} className="space-y-4 max-w-2xl">
                                <div><label className="label-style">채용 사이트</label><Select value={siteForm.site} onChange={(e) => { const site = e.target.value; const existing = siteSettings.find(s => s.site === site); setSiteForm(existing || { site, monthlyCost: 0, quarterlyCost: 0, startDate: '' }); }}><option>사람인</option><option>잡코리아</option><option>인크루트</option></Select></div>
                                <div><label className="label-style">월 이용료 (원)</label><Input type="number" value={siteForm.monthlyCost} onChange={(e) => setSiteForm({...siteForm, monthlyCost: e.target.value})} /></div>
                                <div><label className="label-style">분기 이용료 (원)</label><Input type="number" value={siteForm.quarterlyCost} onChange={(e) => setSiteForm({...siteForm, quarterlyCost: e.target.value})} /></div>
                                <div><label className="label-style">과금 시작일</label><Input type="date" value={siteForm.startDate} onChange={(e) => setSiteForm({...siteForm, startDate: e.target.value})} /></div>
                                <Button type="submit" variant="primary" className="w-full">저장</Button>
                            </form>
                            <div className="mt-8">
                                <h4 className="font-semibold mb-4">현재 설정</h4>
                                <div className="space-y-3">{siteSettings.map(setting => (<div key={setting.id} className="border border-gray-200 rounded-lg p-4"><h5 className="font-semibold text-lg">{setting.site}</h5><p className="text-sm text-gray-600 mt-1">월 {setting.monthlyCost?.toLocaleString()}원 / 분기 {setting.quarterlyCost?.toLocaleString()}원</p>{setting.startDate && <p className="text-sm text-gray-600">시작일: {setting.startDate}</p>}</div>))}</div>
                            </div>
                        </div>
                    )}
                    {activeTab === 'goals' && (
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-xl font-semibold mb-6">월별 목표 설정</h3>
                            <form onSubmit={handleGoalSubmit} className="space-y-4 max-w-2xl">
                                <div><label className="label-style">년월</label><Input type="month" value={goalForm.yearMonth} onChange={(e) => { const yearMonth = e.target.value; const existing = goals.find(g => g.yearMonth === yearMonth); setGoalForm(existing || { yearMonth, targetHires: 0, targetSaramin: 0, targetJobkorea: 0, targetIncruit: 0 }); }} required /></div>
                                <div><label className="label-style">월 채용 목표 인원</label><Input type="number" value={goalForm.targetHires} onChange={(e) => setGoalForm({...goalForm, targetHires: e.target.value})} /></div>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div><label className="label-style">사람인 목표</label><Input type="number" value={goalForm.targetSaramin} onChange={(e) => setGoalForm({...goalForm, targetSaramin: e.target.value})} /></div>
                                    <div><label className="label-style">잡코리아 목표</label><Input type="number" value={goalForm.targetJobkorea} onChange={(e) => setGoalForm({...goalForm, targetJobkorea: e.target.value})} /></div>
                                    <div><label className="label-style">인크루트 목표</label><Input type="number" value={goalForm.targetIncruit} onChange={(e) => setGoalForm({...goalForm, targetIncruit: e.target.value})} /></div>
                                </div>
                                <Button type="submit" variant="primary" className="w-full">저장</Button>
                            </form>
                            <div className="mt-8">
                                <h4 className="font-semibold mb-4">설정된 목표</h4>
                                <div className="space-y-3">{goals.sort((a,b) => b.yearMonth.localeCompare(a.yearMonth)).map(goal => (<div key={goal.id} className="border border-gray-200 rounded-lg p-4"><h5 className="font-semibold text-lg mb-2">{goal.yearMonth}</h5><div className="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"><div><span className="text-gray-600">총 목표</span><p className="goal-value text-blue-600">{goal.targetHires}명</p></div><div><span className="text-gray-600">사람인</span><p className="goal-value">{goal.targetSaramin}명</p></div><div><span className="text-gray-600">잡코리아</span><p className="goal-value">{goal.targetJobkorea}명</p></div><div><span className="text-gray-600">인크루트</span><p className="goal-value">{goal.targetIncruit}명</p></div></div></div>))}</div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- Helper Components & Styles ---
        // components/UI.js로 이동했습니다.
        
        ReactDOM.render(<> <GlobalStyles /> <App /> </>, document.getElementById('root'));
    </script>
</body>
</html>

